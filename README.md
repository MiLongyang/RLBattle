# RLBattle - 强化学习对战平台

本项目是一个基于强化学习的多智能体对抗仿真平台，旨在模拟导弹在海战场景中的博弈过程。平台支持多种主流强化学习算法，并提供了高度模块化和可扩展的框架，便于二次开发与研究。

##  项目特点

- **模块化设计**: 算法、环境、通用模块高度解耦，易于扩展和维护。
- **双算法支持**: 内置 MADDPG 和 QMIX 两种主流多智能体强化学习算法。
- **可配置任务**: 支持多种作战任务类型（如侦察、佯攻、协同打击），便于进行多场景研究。
- **动态设备选择**: 自动检测并优先使用 CUDA GPU 进行训练，若无 GPU 则无缝切换至CPU。
- **集中式参数管理**: 所有超参数通过 `arguments.py` 集中管理，支持命令行覆盖，方便调参和批量实验。
- **模型自动存取**: 训练过程自动保存模型检查点，并提供独立的评估脚本加载指定模型进行性能评估。
- **清晰的扩展接口**: 通过`BaseAlgorithm`抽象基类定义了清晰的算法扩展规范，二次开发成本低。

## 项目目标

- **强化学习平台**: 支持用户选择算法、导弹类型、目标、奖励函数等，并进行训练、推演和结果可视化。
- **对抗环境**: 模拟项目设定的海战场景，包括不同属性的导弹和多样的战术动作。
- **算法接口**: 模块化接入QMIX、MADDPG等现有算法，并提供扩展新算法的接口。
- **前端界面**: 提供用户操作界面和动态的仿真过程展示。
- **结果评估**: 提供训练曲线、命中率、任务完成度、费效比等多种评估指标。

## 目录结构

```
RLBattle/
|-- algorithms/                # 强化学习算法
|   |-- base_algorithm.py      # 所有算法的抽象基类
|   |-- maddpg/                # MADDPG 算法实现
|   |-- qmix/                  # QMIX 算法实现
|-- common/                    # 通用模块
|   |-- replay_buffer.py       # (用于MADDPG) 随机采样经验回放池
|   |-- episode_replay_buffer.py # (用于QMIX) 按回合采样经验回放池
|-- envs/                      # 对抗环境
|   |-- battle_env.py          # 战场环境接口定义
|-- models/                    # 存放训练好的模型
|-- main.py                    # 训练主入口
|-- evaluate.py                # 模型评估入口
|-- arguments.py               # 统一参数配置
|-- requirements.txt           # 项目依赖
|-- README.md                  # 项目说明
```

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 训练模型

- **使用默认参数训练**:
  ```bash
  python main.py
  ```

- **指定算法和任务类型进行训练**:
  ```bash
  python main.py --algorithm QMIX --task_type feint
  ```
  训练好的模型将自动保存在 `models/` 目录下，以 `[算法名]_[任务类型]` 的格式命名。

### 3. 评估模型

- **评估最新训练好的模型**:
  ```bash
  python evaluate.py
  ```

- **评估指定算法、任务和回合数的模型**:
  ```bash
  python evaluate.py --algorithm QMIX --task_type feint --load_model_episode 100
  ```

## 核心接口说明

-   **`arguments.py`**: 项目的唯一参数配置入口。提供 `get_args()` 函数，返回一个包含所有可配置参数的对象。

-   **`main.py`**: 统一的训练主入口。它会根据参数自动初始化环境和算法，执行训练主循环，并定期保存模型。

-   **`evaluate.py`**: 独立的模型评估入口。它会加载指定模型，在环境中运行并输出最终的性能指标。

-   **`envs/battle_env.py`**: 定义了环境必须遵循的接口规范。
    -   `step(actions)`: 核心方法，必须返回包含全局状态 `state` 和 `next_state` 的 `info` 字典。

-   **`algorithms/base_algorithm.py`**: 定义了算法的抽象基类。任何新算法都应继承它，并实现其核心方法。

-   **算法类 (e.g., `MADDPG`, `QMIX`)**: 封装了特定算法的全部逻辑。
    -   `__init__(...)`: 初始化网络、优化器等。
    -   `select_actions(...)`: 根据观测返回动作。
    -   `learn()`: 执行一次学习更新。
    -   `save_models(...) / load_models(...)`: 保存和加载模型权重。

